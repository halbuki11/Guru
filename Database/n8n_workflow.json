{
  "name": "Guroute Weekly Destinations Update",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [1],
              "triggerAtHour": 9
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Her Pazartesi 09:00",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [200, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "={{$credentials.anthropicApiKey}}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-3-haiku-20240307\",\n  \"max_tokens\": 2000,\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"Seyahat uygulamasƒ± i√ßin bu hafta √∂ne √ßƒ±karacaƒüƒ±mƒ±z 10 destinasyon √∂ner. Her destinasyon i√ßin ≈üu bilgileri JSON formatƒ±nda ver:\\n\\n1. name: ≈ûehir/yer adƒ±\\n2. country: √úlke\\n3. description: Kƒ±sa a√ßƒ±klama (max 50 karakter)\\n4. category: story/trending/seasonal/popular birinden\\n5. season: winter/spring/summer/fall/all\\n6. seasonal_tag: Mevsimsel etiket\\n7. rating: 4.0-5.0 arasƒ±\\n8. trend_percentage: 10-60 arasƒ±\\n9. primary_color: hex renk (# olmadan)\\n10. secondary_color: hex renk (# olmadan)\\n11. search_keywords: Unsplash arama i√ßin 3 keyword array\\n\\n√ñnemli:\\n- ≈ûu an {{ $now.format('MMMM') }} ayƒ±ndayƒ±z\\n- Mevsime uygun √∂neriler yap\\n- Farklƒ± kategorilerde dengeli daƒüƒ±t\\n- Pop√ºler ama aynƒ± zamanda ilgin√ß yerler se√ß\\n\\nSadece JSON array d√∂nd√ºr, ba≈üka a√ßƒ±klama ekleme.\"\n    }\n  ]\n}"
      },
      "id": "claude-api",
      "name": "Claude API - Destinasyon √ñner",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [400, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Anthropic API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Claude response'dan JSON array'i parse et\nconst response = $input.first().json;\nconst content = response.content[0].text;\n\n// JSON'u parse et\nlet destinations;\ntry {\n  destinations = JSON.parse(content);\n} catch (e) {\n  // Eƒüer markdown code block i√ßindeyse\n  const match = content.match(/```json\\n([\\s\\S]*?)\\n```/);\n  if (match) {\n    destinations = JSON.parse(match[1]);\n  } else {\n    throw new Error('JSON parse edilemedi');\n  }\n}\n\n// Her destinasyonu ayrƒ± item olarak d√∂nd√ºr\nreturn destinations.map(dest => ({ json: dest }));"
      },
      "id": "parse-destinations",
      "name": "Destinasyonlarƒ± Parse Et",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://api.unsplash.com/search/photos",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Client-ID {{$credentials.unsplashAccessKey}}"
            }
          ]
        },
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ $json.search_keywords.join(' ') }} travel landmark"
            },
            {
              "name": "per_page",
              "value": "1"
            },
            {
              "name": "orientation",
              "value": "landscape"
            }
          ]
        }
      },
      "id": "unsplash-api",
      "name": "Unsplash - G√∂rsel Bul",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [800, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "YOUR_UNSPLASH_CREDENTIAL_ID",
          "name": "Unsplash API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Input'tan destinasyon ve Unsplash sonucunu al\nconst destination = $('Destinasyonlarƒ± Parse Et').item.json;\nconst unsplashResult = $input.first().json;\n\n// G√∂rsel URL'ini al (fallback ile)\nlet imageUrl = 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&q=80';\n\nif (unsplashResult.results && unsplashResult.results.length > 0) {\n  const photo = unsplashResult.results[0];\n  imageUrl = photo.urls.regular + '&w=400&q=80';\n}\n\n// Supabase i√ßin hazƒ±rla\nreturn [{\n  json: {\n    name: destination.name,\n    country: destination.country,\n    description: destination.description,\n    image_url: imageUrl,\n    rating: destination.rating,\n    trend_percentage: destination.trend_percentage,\n    seasonal_tag: destination.seasonal_tag,\n    primary_color: destination.primary_color,\n    secondary_color: destination.secondary_color,\n    category: destination.category,\n    season: destination.season,\n    display_order: $itemIndex + 1,\n    is_active: true,\n    search_keywords: destination.search_keywords,\n    updated_at: new Date().toISOString()\n  }\n}];"
      },
      "id": "prepare-supabase",
      "name": "Supabase Verisi Hazƒ±rla",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 300]
    },
    {
      "parameters": {
        "operation": "upsert",
        "tableId": "destinations",
        "conflictColumns": ["name", "category"],
        "dataToSend": "defineBelow",
        "fieldsUi": {
          "fieldValues": [
            { "fieldName": "name", "fieldValue": "={{ $json.name }}" },
            { "fieldName": "country", "fieldValue": "={{ $json.country }}" },
            { "fieldName": "description", "fieldValue": "={{ $json.description }}" },
            { "fieldName": "image_url", "fieldValue": "={{ $json.image_url }}" },
            { "fieldName": "rating", "fieldValue": "={{ $json.rating }}" },
            { "fieldName": "trend_percentage", "fieldValue": "={{ $json.trend_percentage }}" },
            { "fieldName": "seasonal_tag", "fieldValue": "={{ $json.seasonal_tag }}" },
            { "fieldName": "primary_color", "fieldValue": "={{ $json.primary_color }}" },
            { "fieldName": "secondary_color", "fieldValue": "={{ $json.secondary_color }}" },
            { "fieldName": "category", "fieldValue": "={{ $json.category }}" },
            { "fieldName": "season", "fieldValue": "={{ $json.season }}" },
            { "fieldName": "display_order", "fieldValue": "={{ $json.display_order }}" },
            { "fieldName": "is_active", "fieldValue": "={{ $json.is_active }}" },
            { "fieldName": "search_keywords", "fieldValue": "={{ $json.search_keywords }}" },
            { "fieldName": "updated_at", "fieldValue": "={{ $json.updated_at }}" }
          ]
        }
      },
      "id": "supabase-upsert",
      "name": "Supabase - Kaydet",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1200, 300],
      "credentials": {
        "supabaseApi": {
          "id": "YOUR_SUPABASE_CREDENTIAL_ID",
          "name": "Supabase"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "summary",
              "name": "summary",
              "value": "=‚úÖ Guroute destinasyonlarƒ± g√ºncellendi!\n\nüìç {{ $items.length }} destinasyon i≈ülendi\nüìÖ {{ $now.format('DD MMMM YYYY HH:mm') }}\n\nüîÑ Sonraki g√ºncelleme: Gelecek Pazartesi",
              "type": "string"
            }
          ]
        }
      },
      "id": "set-summary",
      "name": "√ñzet Olu≈ütur",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1400, 300]
    }
  ],
  "connections": {
    "Her Pazartesi 09:00": {
      "main": [
        [{ "node": "Claude API - Destinasyon √ñner", "type": "main", "index": 0 }]
      ]
    },
    "Claude API - Destinasyon √ñner": {
      "main": [
        [{ "node": "Destinasyonlarƒ± Parse Et", "type": "main", "index": 0 }]
      ]
    },
    "Destinasyonlarƒ± Parse Et": {
      "main": [
        [{ "node": "Unsplash - G√∂rsel Bul", "type": "main", "index": 0 }]
      ]
    },
    "Unsplash - G√∂rsel Bul": {
      "main": [
        [{ "node": "Supabase Verisi Hazƒ±rla", "type": "main", "index": 0 }]
      ]
    },
    "Supabase Verisi Hazƒ±rla": {
      "main": [
        [{ "node": "Supabase - Kaydet", "type": "main", "index": 0 }]
      ]
    },
    "Supabase - Kaydet": {
      "main": [
        [{ "node": "√ñzet Olu≈ütur", "type": "main", "index": 0 }]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
